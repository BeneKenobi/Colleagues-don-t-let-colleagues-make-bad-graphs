---
title: "Colleagues Donâ€™t Let Colleagues Make Bad Graphs"
---

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Pie Charts [@Holtz;@Siirtola2019;@Few2007;@Nussbaumer2011]

```{r}
# Libraries
library(ggplot2)
library(tidyverse)
library(viridis)
library(patchwork)
library(ggbeeswarm)
library(grateful)

bene_colors <- c(
    "#47476b",
    "#cda715",
    "#318986",
    "#93003a",
    "#3081ad",
    "#6d3d3d",
    "#79779f",
    "#00c1bf",
    "#777586"
)
bene_palette <- scale_fill_manual(values = bene_colors, breaks = waiver())
bene_palette_shifted <- scale_fill_manual(values = bene_colors[-1], breaks = waiver())

patchwork_defauts <- plot_annotation(theme = theme(plot.background = element_rect(fill = "transparent", colour = NA)))

theme_set(theme_minimal() +
    theme(
        legend.position = "none",
        plot.title = element_blank(),
        panel.grid = element_blank(),
        axis.text = element_blank(),
        legend.margin = unit(0, "null"),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA)
    ))
```

```{r}
#| echo: true
#| code-fold: true
#| label: fig-pies
#| fig-cap: "Pie Charts"
#| warning: false

data1 <- data.frame(name = letters[1:5], value = c(17, 18, 20, 22, 24))
data2 <- data.frame(name = letters[1:5], value = c(20, 18, 21, 20, 20))
data3 <- data.frame(name = letters[1:5], value = c(24, 23, 21, 19, 18))

plot_pie <- function(data) {
    ggplot(data, aes(x = "name", y = value, fill = name)) +
        geom_bar(width = 1, stat = "identity") +
        coord_polar("y", start = 0, direction = -1) +
        bene_palette +
        geom_text(aes(label = name), position = position_stack(vjust = 0.5), color = "white") +
        xlab("") +
        ylab("")
}

a <- plot_pie(data1)
b <- plot_pie(data2)
c <- plot_pie(data3)
a + b + c + patchwork_defauts
```
::: {.notes}
Length is easier to estimate than angle, and the estimation of area is even worse.
:::

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Pie Charts

```{r}
#| echo: true
#| code-fold: true
#| label: fig-pievsstackbar
#| fig-cap: "Pie Charts vs. Bar Charts (stacked)"
#| warning: false

# reuses plots of fig-pies

# add source column to each data frame
data1 <- data1 %>%
    add_column(type = "I")
data2 <- data2 %>%
    add_column(type = "II")
data3 <- data3 %>%
    add_column(type = "III")

# combine data frames into a single data frame
data_combined <- rbind(data1, data2, data3)

g <- ggplot(data_combined, aes(x = rev(type), y = value, fill = name)) +
    geom_bar(position = position_fill(reverse = TRUE), stat = "identity", width = 0.25) +
    bene_palette +
    theme(
        legend.position = "none",
        panel.grid = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank()
    ) +
    scale_x_discrete(expand = c(0, 0.4)) +
    geom_text(aes(label = name), position = position_fill(vjust = 0.5, reverse = TRUE), color = "white") +
    xlab("") +
    ylab("") +
    coord_flip()

layout <- "
AD
BD
CD
"

a + b + c + g + plot_layout(design = layout) + patchwork_defauts
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Pie Charts

```{r}
#| echo: true
#| code-fold: true
#| label: fig-pievsbar
#| fig-cap: "Pie Charts vs. Bar Charts"
#| warning: false

# reuses plots of fig-pies

plot_bar <- function(data) {
    ggplot(data, aes(x = name, y = value, fill = name)) +
        geom_bar(stat = "identity") +
        bene_palette +
        geom_text(aes(label = name), position = position_stack(reverse = TRUE), vjust = 1.5, color = "white") +
        ylim(0, 25) +
        xlab("") +
        ylab("")
}

d <- plot_bar(data1)
e <- plot_bar(data2)
f <- plot_bar(data3)

layout <- "
ABC
ABC
DEF
DEF
DEF
DEF
DEF
"

a + b + c + d + e + f + plot_layout(design = layout) + patchwork_defauts
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Bar Plots for Means Separation [@Weissgerber2015]

```{r}
#| echo: true
#| code-fold: true
#| label: fig-meansseperationbar
#| fig-cap: "Means seperation bar plot"
#| warning: false

bene_palette_shifted <- scale_fill_manual(values = bene_colors[-1], breaks = waiver())

# group1 is sampled from a normal distribution with mean = 1 and sd = 1.
# group2 is sampled from a lognormal distribution with mean = 1 and sd = 1.
set.seed(2363)
group1 <- rnorm(n = 250, mean = 1, sd = 1)
group2 <- rlnorm(
    n = 250,
    meanlog = log(1^2 / sqrt(1^2 + 1^2)),
    sdlog = sqrt(log(1 + (1^2 / 1^2)))
)

groups_long <- cbind(
    group1,
    group2
) %>%
    as.data.frame() %>%
    gather("group", "response", 1:2)

bar <- groups_long %>%
    ggplot(aes(x = group, y = response)) +
    geom_bar(stat = "summary", fun = mean, aes(fill = group), width = 0.5, colour = "black") +
    stat_summary(
        geom = "errorbar", fun.data = "mean_se",
        width = 0.1, size = 1
    ) +
    scale_y_continuous(expand = expand_scale(mult = c(0, 0.1))) +
    bene_palette_shifted +
    theme_classic() +
    theme(
        text = element_text(color = "black"),
        axis.text = element_text(color = "black"),
        legend.position = "none",
        plot.title = element_text(size = 10),
        plot.caption = element_text(hjust = 0),
        axis.line.x = element_line(color = "black"),
        axis.line.y = element_line(color = "black"),
        panel.grid.major.y = element_line(color = "grey"),
        axis.title.x = element_blank()
    ) +
    labs(
        x = "Group",
        y = "Response"
    ) +
    ggtitle(
        paste0(
            "group1: mean = ", signif(mean(group1), 2),
            "; sd = ", signif(sd(group1), 2), "\n",
            "group2: mean = ", signif(mean(group2), 2),
            "; sd = ", signif(sd(group2), 2)
        )
    )

bar
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Bar Plots for Means Separation

```{r}
#| echo: true
#| code-fold: true
#| label: fig-meansseperationall
#| fig-cap: "Means seperation alternatives: box plot and beeswarm plot"
#| warning: false

box <- groups_long %>%
    ggplot(aes(x = group, y = response)) +
    geom_boxplot(aes(fill = group), width = 0.5) +
    labs(
        x = "Group",
        y = "Response"
    ) +
    bene_palette_shifted +
    theme_classic() +
    theme(
        text = element_text(color = "black"),
        axis.text = element_text(color = "black"),
        legend.position = "none",
        plot.title = element_text(size = 10),
        plot.caption = element_text(hjust = 0),
        axis.line.x = element_line(color = "black"),
        axis.line.y = element_line(color = "black"),
        panel.grid.major.y = element_line(color = "grey"),
        axis.title.x = element_blank()
    ) +
    ggtitle(
        paste0(
            "group1: median = ", signif(median(group1), 2),
            "; IQR = ", signif(IQR(group1), 2), "\n",
            "group2: median = ", signif(median(group2), 2),
            "; IQR = ", signif(IQR(group2), 2)
        )
    )

beeswarm <- groups_long %>%
    ggplot(aes(x = group, y = response)) +
    geom_beeswarm(alpha = 0.8, size = 2, shape = 21, color = "black", aes(fill = group), cex = 1.7, method = "compactswarm") +
    bene_palette_shifted +
    labs(
        x = "Group",
        y = "Response"
    ) +
    theme_classic() +
    theme(
        text = element_text(color = "black"),
        axis.text = element_text(color = "black"),
        legend.position = "none",
        plot.title = element_text(size = 10),
        plot.caption = element_text(hjust = 0),
        axis.line.x = element_line(color = "black"),
        axis.line.y = element_line(color = "black"),
        panel.grid.major.y = element_line(color = "grey"),
        axis.title.x = element_blank()
    ) +
    ggtitle(
        paste0(
            "group1: median = ", signif(median(group1), 2),
            "; IQR = ", signif(IQR(group1), 2), "\n",
            "group2: median = ", signif(median(group2), 2),
            "; IQR = ", signif(IQR(group2), 2)
        )
    )

bar + box + beeswarm + patchwork_defauts
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Violin Plots for Small Sample Sizes

```{r}
#| echo: true
#| code-fold: true
#| label: fig-violinoplotsmall1
#| fig-cap: "Violin plots for small sample sizes (dot at median)"
#| warning: false

# Generate three sets of data from a normal distribution with mean = 1 and sd = 1.

set.seed(666)

data_set <- replicate(rnorm(5, mean = 1, sd  = 1), n = 3, simplify = T) %>% 
  as.data.frame() %>% 
  gather("sample", "Response", 1:3) %>% 
  mutate(Group = str_replace(sample, "V", "group"))

violin_eg <- data_set %>% 
  ggplot(aes(x = Group, y = Response)) +
  geom_violin(aes(fill = Group), trim = FALSE) +
  stat_summary(geom = "point", fun = median) +
  bene_palette_shifted +
  theme_classic()+
  theme(
    text = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    panel.grid.major.y = element_line(color = "grey"),
    legend.position = "none",
    axis.title.x = element_blank()
  )

violin_eg
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Violin Plots for Small Sample Sizes

```{r}
#| echo: true
#| code-fold: true
#| label: fig-violinoplotsmall2
#| fig-cap: "Violin plots and box plots for small sample sizes"
#| warning: false

box_eg <- data_set %>% 
  ggplot(aes(x = Group, y = Response)) +
  geom_boxplot(aes(fill = Group)) +
  bene_palette_shifted +
  theme_classic()+
  theme(
    text = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    panel.grid.major.y = element_line(color = "grey"),
    legend.position = "none",
    axis.title.x = element_blank()
  )


violin_eg + box_eg
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Violin Plots for Small Sample Sizes

```{r}
#| echo: true
#| code-fold: true
#| label: fig-violinoplotsmall3
#| fig-cap: "Violin plots, box plots and jitter plots for small sample sizes (n = 5)"
#| warning: false

jitter_eg <- data_set %>% 
  ggplot(aes(x = Group, y = Response)) +
  geom_point(aes(fill = Group), shape = 21, size = 3, color = "black",
             position = position_jitter(seed = 1, width = 0.2)) +
  bene_palette_shifted +
  theme_classic()+
  theme(
    text = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    panel.grid.major.y = element_line(color = "grey"),
    legend.position = "none",
    axis.title.x = element_blank()
  )


violin_eg + box_eg + jitter_eg
```

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Bar Plot Meadows

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Heatmaps without Checking Outliers

## [Colleagues Don't Let Colleagues Make]{.smallHeader} Plots with Red/Green or Rainbow color scales

##

::: {.center .center-y layout-valign="bottom"}
Presentation based on

*Friends Don't Let Friends Make Bad Graphs* [@Li2023]

[---]{}

Source code available at [![](images/github-mark.svg){height=1em .bottom} GitHub](https://github.com/BeneKenobi/Colleagues-don-t-let-colleagues-make-bad-graphs)
:::

## R Packages Used {.smaller}

```{r}
cite_packages(output = "table", out.dir = ".") %>%
    mutate(Package = paste(Package, " [", Citation, "]", sep = "")) %>%
    select(-Citation) %>%
    knitr::kable(col.names = c("Package", "Version"), align = "lr")
```

## References {.smaller visibility="uncounted" .unnumbered .unlisted}

::: {#refs}
:::